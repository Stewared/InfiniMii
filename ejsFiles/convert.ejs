<!DOCTYPE html>
<html lang="en">
    <head>
        <%
        const pageTitle = 'Convert Mii Characters Between Formats - InfiniMii';
        const pageDesc = 'Free Mii converter tool. Convert Miis between Wii, 3DS, Wii U, and Switch formats. Support for backporting and all Mii file types including QR codes and bin files.';
        const canonicalUrl = `${baseUrl}/about`;
        const keywords = 'mii converter, convert mii, wii to 3ds, 3ds to wii, mii format converter, backport mii';

        // HowTo Schema data
        const howToTitle = 'How to Convert Miis Between Nintendo Systems';
        const howToDescription = 'Step-by-step guide to convert Mii characters between Wii, 3DS, Wii U, and Switch formats using InfiniMii\'s free online converter.';
        const howToDuration = 'PT2M';
        const howToSupplies = [
            {"@type": "HowToSupply", "name": "Mii file (Wii .mii or 3DS .bin) or QR code image"}
        ];
        const howToTools = [
            {"@type": "HowToTool", "name": "InfiniMii Converter", "url": `${baseUrl}/convert`}
        ];
        const howToSteps = [
            {
                "@type": "HowToStep",
                "name": "Upload Your Mii File",
                "text": "Select your Mii file (.mii for Wii, .bin for 3DS, or QR code image) and upload it to the converter.",
                "url": "${baseUrl}/convert#step-1",
                "image": "${baseUrl}/guide-images/upload-step.jpg"
            },
            {
                "@type": "HowToStep",
                "name": "Select Source Format",
                "text": "Choose whether you're converting from Wii, 3DS, Wii U, or a QR code.",
                "url": "${baseUrl}/convert#step-2"
            },
            {
                "@type": "HowToStep",
                "name": "Choose Target Format",
                "text": "Select the format you want to convert to: Wii Mii, 3DS/Wii U Mii, Special Wii Mii, or Special 3DS Mii.",
                "url": "${baseUrl}/convert#step-3"
            },
            {
                "@type": "HowToStep",
                "name": "Download Converted File",
                "text": "Click Convert and download your Mii in the new format. The file will be ready to use on your target Nintendo system.",
                "url": "${baseUrl}/convert#step-4"
            }
        ];
        %>
        <%- include('metaTags') %>
        <%- include('structuredData') %>
        
        <link rel="stylesheet" href="./global.css">
        <link rel="stylesheet" href="utilityPages.css">
    </head>
    <body>
        <%- include('globalStyle') %>
        <%- include('header') %>
        <%- include('accountDisplay') %>
        
        <main class="content" role="main">
            <%- include('sidebar') %>
            
            <article class="utility-container">
                <form id="convertForm" method="POST" enctype="multipart/form-data" action="/convertMii">
                    <fieldset>
                        <legend>Convert Mii Character Between Formats</legend>
                        
                        <div class="conversion-info">
                            <h3>Supported Conversions:</h3>
                            <ul>
                                <li><strong>3DS/Wii U to Wii</strong> - Backport newer Miis to classic Wii</li>
                                <li><strong>Wii to 3DS/Wii U</strong> - Upgrade classic Miis with new features</li>
                                <li><strong>QR Code Scanning</strong> - Import from QR images</li>
                                <li><strong>Format Optimization</strong> - Special variants for both systems</li>
                            </ul>
                        </div>
                        
                        <label for="mii-file">Upload Mii File or QR Code:</label>
                        <a href="/qr" class="qr-link">Or scan a 3DS/Wii U QR Code with your camera</a>
                        
                        <input 
                            type="file" 
                            id="mii-file"
                            name="mii" 
                            accept=".jpg,.png,.mii,.bin"
                            required
                            aria-required="true">
                        
                        <label for="from-type">Convert from:</label>
                        <select id="from-type" name="fromType" required aria-required="true">
                            <option value="3DS/Wii U">3DS/Wii U</option>
                            <option value="Wii">Wii</option>
                        </select>
                        
                        <label for="to-type">Convert to:</label>
                        <select id="to-type" name="toType" required aria-required="true">
                            <option value="Wii Mii">Wii Mii</option>
                            <option value="3DS/Wii U Mii">3DS/Wii U Mii</option>
                            <option value="Special Wii Mii">Special Wii Mii</option>
                            <option value="Special 3DS Mii">Special 3DS Mii</option>
                        </select>
                        
                        <input type="submit" value="Convert Mii">
                        <div id="convertError" style="color: red; margin-top: 10px; display: none;"></div>
                        
                        <h6><strong>Note:</strong> 3DS/Wii U to Wii conversions may have limitations due to hardware differences. The 3DS and Wii U support more customization options than the original Wii. <a href="https://github.com/Stewared/MiiJS?tab=readme-ov-file#discrepancies-in-convertmii-function" target="_blank" rel="noopener">Learn more about conversion differences</a>.</h6>
                    </fieldset>
                </form>

                <!-- For SEO/LLM-O -->
                <div hidden>
                    <section class="what-is">
                        <h2>What is a Mii Converter?</h2>
                        <p>A Mii converter is a tool that transforms <strong>Mii character data</strong> between different <strong>Nintendo system formats</strong>. Each Nintendo console (Wii, 3DS, Wii U, Switch) uses a slightly different file format for storing Mii data. InfiniMii's converter handles all formats, including:</p>
                        <ul>
                            <li><strong>Wii .mii files</strong> - Original Mii format from Nintendo Wii</li>
                            <li><strong>3DS/Wii U .bin files</strong> - Enhanced format with more customization options</li>
                            <li><strong>QR codes</strong> - Scannable images for 3DS, Wii U, Tomodachi Life, and Miitomo</li>
                            <li><strong>Switch Mii data</strong> - Latest format for Nintendo Switch systems</li>
                        </ul>
                    </section>
                    
                    <section class="why-convert">
                        <h2>Why Convert Mii Formats?</h2>
                        <ul>
                            <li><strong>Transfer characters between systems</strong> - Move your favorite Miis from Wii to 3DS or vice versa</li>
                            <li><strong>Backport modern Miis</strong> - Use 3DS Miis on the original Wii (with some limitations)</li>
                            <li><strong>Generate QR codes</strong> - Create scannable codes for any Mii character</li>
                            <li><strong>Preserve old Miis</strong> - Convert legacy characters to modern formats for long-term storage</li>
                        </ul>
                    </section>
                    <section class="faq-section" hidden>
                        <h2>Common Mii Conversion Questions</h2>
                        
                        <div class="faq-item">
                            <h3>Can I convert Miis from Wii to 3DS?</h3>
                            <p><strong>Answer:</strong> Yes! Wii Miis can be converted to 3DS format perfectly. The 3DS has more customization options than the Wii, so your converted Mii can even be enhanced after conversion.</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Can I convert 3DS Miis to Wii format?</h3>
                            <p><strong>Answer:</strong> Yes, but with limitations. The Wii doesn't support all the facial features available on the 3DS. InfiniMii will automatically adjust features to the closest Wii equivalent during conversion.</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>How do I use QR codes with my Mii?</h3>
                            <p><strong>Answer:</strong> After conversion, you can generate a QR code for any Mii. On your 3DS or Wii U, open Mii Maker, select "QR Code/Image Options," then "Scan QR Code" and point your camera at the code.</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Does converting affect Mii quality?</h3>
                            <p><strong>Answer:</strong> No. Converting between formats doesn't reduce the quality of compatible features. Only when converting from a newer system to an older one (like 3DS to Wii) might some advanced features be simplified.</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Can I convert Miis to Nintendo Switch format?</h3>
                            <p><strong>Answer:</strong> The Switch uses a proprietary format that requires manual recreation or an Amiibo. Use our <a href="/transferInstructions">transfer guide</a> for step-by-step instructions on transferring Miis to and from the Switch/2.</p>
                        </div>
                    </section>
                    <section class="related-tools">
                        <h2>Related Mii Tools</h2>
                        <ul>
                            <li><a href="/qr">QR Code Scanner</a> - Scan Mii QR codes from images</li>
                            <li><a href="/upload">Upload Mii</a> - Share your Miis with the community</li>
                            <li><a href="/transferInstructions">Transfer Guide</a> - Move Miis between all Nintendo systems</li>
                            <li><a href="/">Browse Miis</a> - Find characters to convert</li>
                        </ul>
                    </section>
                </div>
            </article>
            
            <%- include('featuredMiis') %>
        </main>
        
        <%- include('footer') %>
        <script src="/global.js" defer></script>
        <script>
            document.querySelector('form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const submitBtn = this.querySelector('input[type="submit"]');
                const originalText = submitBtn.value;
                
                submitBtn.value = 'Converting...';
                submitBtn.disabled = true;
                
                try {
                    const response = await fetch('/convertMii', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        // For file downloads, the response will be handled automatically
                        // For redirects, we need to handle it
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('application/json')) {
                            const result = await response.json();
                            if (result.error) {
                                alert(result.error);
                            }
                        } else {
                            // Handle file download or redirect
                            const contentDisposition = response.headers.get('content-disposition');
                            if (contentDisposition && contentDisposition.includes('attachment')) {
                                // File download
                                const blob = await response.blob();
                                const url = window.URL.createObjectURL(blob);
                                const a = document.createElement('a');
                                a.href = url;
                                const filename = contentDisposition.split('filename=')[1].replace(/"/g, '');
                                a.download = filename;
                                document.body.appendChild(a);
                                a.click();
                                window.URL.revokeObjectURL(url);
                                document.body.removeChild(a);
                            } else {
                                // Redirect
                                window.location.href = result.redirect;
                            }
                        }
                    } else {
                        const result = await response.json();
                        alert(result.error || 'Conversion failed');
                    }
                } catch (error) {
                    console.error('Conversion error:', error);
                    alert('An error occurred during conversion. Please try again.');
                } finally {
                    submitBtn.value = originalText;
                    submitBtn.disabled = false;
                }
            });
        </script>
    </body>
</html>
<!-- TODO_RES: instead of alerting error,  -->