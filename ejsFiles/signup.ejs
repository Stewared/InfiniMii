<!DOCTYPE html>
<html>

<head>
    <title>Signup - InfiniMii</title>
    <%- include('metaTags') %>
    <%- include('structuredData') %>
    <link href="./global.css" rel="stylesheet">
    <link href="./index.css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Preload critical resources -->
    <link rel="preload" as="image" href="/banner.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
</head>

<body>
    <header>
        <a href="/"><img src='banner.png'></a><br>
        <h6><em>In Development</em></h6>
    </header>
    <div class="content">
        <div class="left-sidebar">
            <!--Emojis to be replaced with images (?)
        Polar: We can probably replace with svg/icons
				Yeah, I just have to take the time to find/make them :wide_bobert:
        Google icons fonts.google.com/icons
				Cool, I'll mess with those soon
        -->
            <ul class="sidebar-list">
                <a href="/search">
                    <li>üîç Search</li>
                </a>
                <a href="/trending">
                    <li>üìà Trending Miis</li>
                </a>
                <a href="/Top">
                    <li>ü•á Top Miis</li>
                </a>
                <a href="/recent">
                    <li>‚è±Ô∏è Recent Miis</li>
                </a>
                <a href="/official">
                    <li>üåü Official Miis</li>
                </a>
            </ul>
            <br>
            <ul class="sidebar-list">
                <a href="/upload">
                    <li>‚¨ÜÔ∏è Upload</li>
                </a>
                <!--Make it the user's profile picture, remove this option if not logged in-->
                <a href='/signup'>
                    <li><img src="avatars/default.png" width="18px" height="18px"> Profile</li>
                </a>
                <a href="/settings">
                    <li>‚öôÔ∏è Settings</li>
                </a>
                <a href="/convert">
                    <li>‚û°Ô∏è Convert</li>
                </a>
                <a href="/qr">
                    <li>üì∏ QR Options</li>
                </a>
            </ul>
            <!-- Submit Mii: -->
            <!--TODO: Have separate forms for 3DS uploads and Wii uploads-->
            <!--<form action="/uploadMii?type=3ds" method="post" enctype="multipart/form-data">
          <fieldset>
            <legend>Submit 3DS Mii</legend>
            <input type="file" name="mii" id="mii" accept=".jpg,.png">
            <input type="submit" id="submit">
          </fieldset>
        </form>
        <form action="/uploadMii?type=wii" method="post" enctype="multipart/form-data">
          <fieldset>
            <legend>Submit Wii Mii</legend>
            <input type="file" name="mii" id="mii" accept=".mii,.bin">
            <input type="submit" id="submit">
          </fieldset>
        </form>
        <form action="/makeSpecialMii?type=3ds" method="post" enctype="multipart/form-data">
          <fieldset>
            <legend>Make Special 3DS Mii</legend>
            <input type="file" name="mii" id="mii" accept=".jpg,.png">
            <input type="submit" id="submit">
          </fieldset>
        </form>
        <form action="/makeSpecialMii?type=wii" method="post" enctype="multipart/form-data">
          <fieldset>
            <legend>Make Special Wii Mii</legend>
            <input type="file" name="mii" id="mii" accept=".mii,.bin">
            <input type="submit" id="submit">
          </fieldset>
        </form>-->
        </div>
        <form id="signupForm">
            <fieldset>
                <legend>Sign Up</legend>
                <input placeholder="Username" required name="username" type="text" id="username">
                <input type="password" placeholder="Password" required name="pass" id="password">
                <input placeholder="Email" required name="email" type="email" id="email">
                <input type="submit" value="Sign Up"><br>
                <h6>*Note: It can take up to 10 minutes for the email to propagate, especially for gmail emails. Please be patient.</h6>
                <div id="errorMessage" style="color: red; margin-top: 10px; display: none;"></div>
            </fieldset>
        </form>
    </div>
    <footer>
        <ul>
            <li><a href="mailto:kestron@kestron.com">Contact</a></li>
            <!-- <li><a href="/support">Support</a></li> -->
            <li><a href="/donate">Donate</a></li>
            <li><a href='https://discord.gg/k3yVkrrvez'>Discord</a></li>
        </ul>
    </footer>
    <script src="/global.js"></script>
    <script>
        document.getElementById('signupForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value;
            const errorDiv = document.getElementById('errorMessage');
            
            try {
                const response = await fetch('/signup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: new URLSearchParams({ username, pass: password, email })
                });
                
                const result = await response.json();
                
                if (result.error) {
                    errorDiv.textContent = result.error;
                    errorDiv.style.display = 'block';
                } else {
                    // Success - show message
                    errorDiv.textContent = result.message || 'Account created successfully! Check your email to verify.';
                    errorDiv.style.color = 'green';
                    errorDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Signup error:', error);
                errorDiv.textContent = 'An error occurred during signup. Please try again.';
                errorDiv.style.display = 'block';
            }
        });
    </script>
</body>

</html>